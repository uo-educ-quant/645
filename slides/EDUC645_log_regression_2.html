<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Logistic Regression Part 2: Model Fitting / Diagnostics</title>
    <meta charset="utf-8" />
    <script src="EDUC645_log_regression_2_files/header-attrs-2.21/header-attrs.js"></script>
    <link href="EDUC645_log_regression_2_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="EDUC645_log_regression_2_files/remark-css-0.0.1/uo.css" rel="stylesheet" />
    <link href="EDUC645_log_regression_2_files/remark-css-0.0.1/ki-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="my_custom.css" type="text/css" />
    <link rel="stylesheet" href="xaringanthemer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Logistic Regression Part 2: Model Fitting / Diagnostics
]
.subtitle[
## EDUC 645
]

---





---
# Revisiting the GLM

Recall that our generalized linear regression model is written as:

`$$Y_{i} = \color{blue}{\beta_{0} + \beta_{1} X} + \color{green}{\varepsilon_{i}}$$`

 + `\(Y_{i}\)`: Our outcome, with the subscript `\(i\)` to emphasize that the model estimates the outcome for each of the `\(i\)` units (students, schools, patients, etc.)

 + `\(\color{blue}{\beta_{0}}\)` and `\(\color{blue}{\beta_{1}}\)`: Our population parameters and regression coefficients to be estimated

 + `\(\color{green}{\varepsilon_{i}}\)`: Our error/residual


--
The `\(\color{blue}{\text{logit link}}\)` allows us to connect GLM linear regression with logistic regression. 

`$$\log(\frac{p}{1-p})$$`

 + `\(p\)`: Probability of a given event

---
# Using Logit Link in Logistic Regression

When we have an outcome variable that follows the binomial distribution, as does a dichotomous variable, we can insert the logit link function into our GLM model:


--
`$$\color{green}{Y_i}=\beta_0 + \beta_1 x_i + \varepsilon_{i}$$`


--
`$$\color{green}{Y_i} = \color{blue}{\log(\frac{p_i}{1-p_i})}$$`

Becomes...

--
`$$\color{blue}{\log(\frac{p_i}{1-p_i})}=\beta_0 + \beta_1 x_i +  \varepsilon_i$$`

 + `\(Y_i\)` is the number events of `\(n\)` observations. 
 + `\(p_i\)` is the probability of an event on a single observation. 

---
# Likelihood methods

Fitting logistic regression requires estimation using likelihood methods:

- *Likelihood* function tells us how likely we are to observe our data for a given parameter value, `\(p{\beta}\)`. 

- Come into play is when data is produced from a complex structure that could imply correlation between outcomes (e.g., students' test scores taught by the same teacher)

- Provide flexibility in the types of models we can fit

- Provide ways in which to compare models

- *Maximum likelihood estimation (MLE)* is a general class of method in statistics that is used to estimate the model parameters

---

class: middle, inverse

# Setting Up the Model

---

# Data check

Before setting up the model, we should check that our variables are the correct types. Dichotomous variables should be *factors*, and continuous variables should be *numeric* (num) or *integers* (int).


```r
str(NHANES_data)
```

```
#&gt; tibble [4,088 Ã— 8] (S3: tbl_df/tbl/data.frame)
#&gt;  $ ID            : int [1:4088] 62163 62172 62174 62174 62176 62178 62180 62186 62190 62199 ...
#&gt;  $ Age           : int [1:4088] 14 43 80 80 34 80 35 17 15 57 ...
#&gt;  $ Sex           : Factor w/ 2 levels "female","male": 2 1 2 2 1 2 2 1 1 2 ...
#&gt;  $ Race_Eth      : Factor w/ 5 levels "Asian","Black",..: 1 2 3 3 3 3 3 2 4 3 ...
#&gt;  $ Diabetes      : Factor w/ 2 levels "No","Yes": 1 1 1 1 1 1 1 1 1 1 ...
#&gt;  $ Depress_Freq  : Factor w/ 3 levels "None","Several",..: NA 3 1 1 1 2 2 NA NA 1 ...
#&gt;  $ PhysActive    : Factor w/ 2 levels "No","Yes": 1 1 1 1 2 1 1 2 1 2 ...
#&gt;  $ PhysActiveDays: int [1:4088] 1 2 7 5 5 NA NA 4 7 2 ...
```
  
---
# Regression equation components

`$$Diabetes = \color{orange}{(\beta_0)} + \color{green}{(\beta_1)}(Age)$$`

`\(\beta_1\)`: Change in *log odds* for 1 unit change in `\(X_i\)`

&lt;span style = "color:orange"&gt; Intercept `\((\beta_0)\)`: &lt;/span&gt; Predicted outcome when X is equal to 0.

&lt;span style = "color:green"&gt; Slope `\((\beta_1)\)`: &lt;/span&gt; Predicted increase in the outcome for every one unit increase in X.

---
# Logistic regression model estimates

`family` refers to the type of distribution, where we have defined `binomial`, and the `link` asks for the link function that we want to use, which is the `logit` for a logistic regression.

We'll start with a continuous independent variable `Age`. Example question: Is increased age associated with greater odds of diabetes? 

---
# Logistic regression model estimates


```r
mod_1 &lt;- glm(Diabetes ~ Age, data = NHANES_data,
                 family = binomial(link = "logit"))
summary(mod_1)
```

```
#&gt; 
#&gt; Call:
#&gt; glm(formula = Diabetes ~ Age, family = binomial(link = "logit"), 
#&gt;     data = NHANES_data)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;     Min       1Q   Median       3Q      Max  
#&gt; -0.8425  -0.4715  -0.3221  -0.2182   2.8767  
#&gt; 
#&gt; Coefficients:
#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept) -4.815044   0.196561   -24.5   &lt;2e-16 ***
#&gt; Age          0.049523   0.003302    15.0   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 2483.2  on 4087  degrees of freedom
#&gt; Residual deviance: 2218.5  on 4086  degrees of freedom
#&gt; AIC: 2222.5
#&gt; 
#&gt; Number of Fisher Scoring iterations: 6
```

---
# Logistic regression model estimates

Or, our question could be: Do inactive participants have greater odds of diabetes than active participants, controlling for age? 

We can add our categorical activity variable `PhysActive`:

---
# Logistic regression model estimates


```r
mod_2 &lt;- glm(Diabetes ~ PhysActive + Age, data = NHANES_data,
                 family = binomial(link = "logit"))
summary(mod_2)
```

```
#&gt; 
#&gt; Call:
#&gt; glm(formula = Diabetes ~ PhysActive + Age, family = binomial(link = "logit"), 
#&gt;     data = NHANES_data)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;     Min       1Q   Median       3Q      Max  
#&gt; -0.8935  -0.4771  -0.3193  -0.2160   2.9240  
#&gt; 
#&gt; Coefficients:
#&gt;                Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept)   -4.455135   0.213962 -20.822  &lt; 2e-16 ***
#&gt; PhysActiveYes -0.460732   0.117705  -3.914 9.07e-05 ***
#&gt; Age            0.046788   0.003375  13.863  &lt; 2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 2481.6  on 4079  degrees of freedom
#&gt; Residual deviance: 2202.7  on 4077  degrees of freedom
#&gt;   (8 observations deleted due to missingness)
#&gt; AIC: 2208.7
#&gt; 
#&gt; Number of Fisher Scoring iterations: 6
```

---
# Output

- Remember that the quantities the model is working in are *log odds*, but we want to be working in *odds* and *odds ratios*. To do this, we need to exponentiate our model parameters.


--
- The default output also doesn't provide us confidence intervals, which we need for interpreting how precise are results are. 


--
  + For logistic models, we use what are called *profiled* confidence intervals. The standard CI you learned about last term (the Wald CI) is strongly dependent on the assumption of normality. The profiled CI is less sensitive to this assumption, and takes advantage of the same likelihood methods we use to estimate the model. 


---
# Output


```r
mod_2 %&gt;% 
      broom::tidy(exponentiate = TRUE, conf.int = TRUE)
```

<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-4">
<col><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">conf.low</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">conf.high</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0116</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.214&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-20.8&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.73e-96</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.00757</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0175</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">PhysActiveYes</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.631&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.118&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-3.91</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">9.07e-05</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.5&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.794&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Age</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.05&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.00337</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13.9&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.06e-43</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.04&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.05&nbsp;&nbsp;</td></tr>
</table>


---
# Assumptions and Diagnostics

- Outcome (Y) is discrete binomial variable (0/1 variable)

- Must be enough responses in every category

- Linearity in the logit scale 
  - X's must be linearly related to logit(Y)
  
- Absence of multicollinearity

- No outliers

- Independence of (X,Y)'s 
  + No clustering of data into groups/contexts that would provide information about the values of other errors

---
# Assumptions and Diagnostics


```r
check_model(mod_2) # From the easystats package
```

&lt;img src="EDUC645_log_regression_2_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;

---
# To Dos

### Assignments
- Assignment 1 is due April 25 at 11:59PM

  + Available on Canvas on Monday April 17
  
- Quiz 1 is due April 18 at 11:59PM

  + Available on Canvas on Friday April 14
  
  
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
