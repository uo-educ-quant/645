---
title: "Count Outcomes and Poisson Regression"
subtitle: "EDUC 645 (Spring 2023)"
#author:
#date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  xaringan::moon_reader:
    css: ['default', 'uo', 'ki-fonts', 'my_custom.css', 'xaringanthemer.css']
    # self_contained: true
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
  editor_options: 
  chunk_output_type: console
---

```{R, setup, include = F}
library(pacman)
p_load(NHANES, easystats, emmeans, DHARMa, ggeffects,
       here, tidyverse, ggplot2, xaringan, knitr, kableExtra, foreign, broom, xaringanthemer, reshape2, lfe, arsenal, ggpubr, stargazer, fixest, gtsummary, huxtable, aod)

i_am("slides/EDUC645_poisson_regression_Sp23.rmd")

extra_css <- list(
  ".red"   = list(color = "red"),
  ".blue"  =list(color = "blue"),
  ".green" = list(color = "#8bb174"),
  ".purple" = list(color = "#6A5ACD"),
  ".red-pink" = list(color= "#e64173"),
  ".grey-light" = list(color= "grey70"),
  ".slate" = list(color="#314f4f"),
  ".small" = list("font-size" = "90%"))

write_extra_css(css = extra_css, outfile = "my_custom.css")

# Knitr options
opts_chunk$set(
  comment = "#>",
  fig.align = "center",
  fig.height = 5,
  fig.width = 8,
  warning = F,
  message = F
)

NHANES_data1112 <- NHANES::NHANES %>% 
  select(ID, SurveyYr, Gender, Age, AgeDecade, Race3, Education, Poverty, Diabetes, DaysMentHlthBad, Depressed, PhysActive) %>% 
  mutate(Race_Eth = as_factor(case_when(Race3 == "Mexican" | Race3 == "Hispanic" ~ "Hispanic/Latino",
                                        TRUE ~ Race3)),
         PhysActive = as_factor(case_when(PhysActive == "No" ~ "Inactive",
                                          PhysActive == "Yes" ~ "Active")),
         PhysActive = factor(PhysActive, levels = c("Active", "Inactive")),
         DaysMHBad_most = as_factor(case_when(DaysMentHlthBad < 10 ~ "No",
                                              DaysMentHlthBad >= 10 ~ "Yes")),
         DaysMHBad_most = factor(DaysMHBad_most, levels = c("No", "Yes"))) %>% 
  rename(Depress_Freq = Depressed, Sex = Gender, DaysMHBad_count = DaysMentHlthBad) %>% 
  select(ID, SurveyYr, Age, Sex, Race_Eth, Diabetes, Depress_Freq, PhysActive, DaysMHBad_count, DaysMHBad_most) %>%   filter(SurveyYr == "2011_12", Age > 12) %>% 
  filter(if_all(everything(), ~!is.na(.))) %>% 
  select(-SurveyYr)
```

class: middle, inverse

# What makes a count outcome a count?


---
# Count outcomes 

Count outcomes describe how many of an outcome are present, or how often an outcome occurs (i.e, how many of an outcome are present *in a given timeframe*). The latter are often called *rates*.


--
Counts are numeric like continuous outcomes, but have a few unique properties:


--
- They can only be positive.


--
- They are related to probability because they describe the presence or absence of an outcome.


--
- They are often **overdispersed**, which means they vary more than would be expected.


--
For these reasons, counts and rates violate key assumptions of linear regression and require analyses that account for these properties.  


---
# Count versus normally distributed data

Let's look at `DaysMHBad_count`, the number of days per month a participant reports experiencing poor mental health.


--
```{r, warning=FALSE, echo=FALSE}
NHANES_data1112 %>% 
  ggplot(aes(DaysMHBad_count)) +
  geom_histogram(binwidth = 1)
```

---
# Count versus normally distributed data

Contrast with the self-reported number of hours of sleep a study participant usually gets, `SleepHrsNight`.


--
```{r, warning=FALSE, echo=FALSE}
NHANESraw %>% 
  ggplot(aes(SleepHrsNight)) +
  geom_histogram(binwidth = 0.5)
```


---
# Options for Analysing Count Data


--
*Linear regression:* Count outcome variables are sometimes log-transformed and analyzed using OLS regression. 


--
- Many issues in addition to violating model assumptions, including loss of data due to undefined values generated by taking the log of zero (which is undefined) and biased estimates.


--
*Poisson regression:* Often used for modeling count data. 


--
*Negative binomial regression:* A more generalized version of Poisson regression.


--
*Zero-inflated regression model:* Used to account for excess zeros (e.g., if the outcome is student absences, most students will have no absences).


---
# To Dos

### Reading
- BMLR Ch. 4.5-4.10, Ch. 5

### Assignments
- Quiz 2 Due May 5 (moved from May 2)