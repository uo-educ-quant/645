<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Count Outcomes and Poisson Regression</title>
    <meta charset="utf-8" />
    <script src="EDUC645_poisson_regression_Sp23_files/header-attrs-2.21/header-attrs.js"></script>
    <link href="EDUC645_poisson_regression_Sp23_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="EDUC645_poisson_regression_Sp23_files/remark-css-0.0.1/uo.css" rel="stylesheet" />
    <link href="EDUC645_poisson_regression_Sp23_files/remark-css-0.0.1/ki-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="my_custom.css" type="text/css" />
    <link rel="stylesheet" href="xaringanthemer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Count Outcomes and Poisson Regression
]
.subtitle[
## EDUC 645 (Spring 2023)
]

---




class: middle, inverse

# What makes a count outcome a count?


---
# Count outcomes 

Count outcomes describe how many of an outcome are present, or how often an outcome occurs (i.e., how many of an outcome are present *in a given timeframe*). The latter are often called *rates*.


--
Counts are numeric like continuous outcomes, but a distribution of counts:


--
- Is usually **skewed**, meaning that some values are much more common than others.


--
- Is often **overdispersed**, which means the counts vary more than would be expected.


--
Counts and rates require analyses that account for these properties.  


---
# Count data

Let's look at `DaysMHBad_count`, the number of days per month a participant reports experiencing poor mental health.


--
&lt;img src="EDUC645_poisson_regression_Sp23_files/figure-html/unnamed-chunk-1-1.png" style="display: block; margin: auto;" /&gt;

---
# Closer-to-normally-distributed data

Contrast with the self-reported number of hours of sleep a participant usually gets, `SleepHrsNight`.


--
&lt;img src="EDUC645_poisson_regression_Sp23_files/figure-html/unnamed-chunk-2-1.png" style="display: block; margin: auto;" /&gt;


---
# Options for Analysing Count Data


--
*Linear regression:* Count outcome variables are sometimes log-transformed and analyzed using OLS regression. 


--
- Many issues in addition to violating model assumptions, including loss of data because it necessary to take the log of zero (which is undefined) and biased estimates.


--
*Poisson regression:* Often used for modeling count data. 


--
*Negative binomial regression:* Similar to Poisson regression, but relaxes a restrictive assumption (to be discussed in a few slides).


--
*Zero-inflated regression model:* Used to account for excess zeros.

---
class: middle, inverse

# Analyzing Count Data

---
# Distributions for counts

Both logistic and Poisson regression are forms of the binomial distribution, which is the probability distribution of one or more "trials" that can result in one of two outcomes. 


--
- An example of one trial is a single flip of a coin that can result in a heads or a tails. The result of this trial can be described with a single datapoint indicating whether the outcome was heads (or tails, if that was our interest).


--
In logistic regression, our outcome data *also* consists of a single value - whether a participant has diabetes, whether a person is dead, whether a student is absent. This is like saying we have a single trial for each participant. 


--
- So, if we're interested in the relationship between the independent variable(s) and the chances of having one of the two outcomes of that one trial (over many participants), we can use a Bernoulli distribution. This is a form of the binomial distribution that is limited to only one trial. 


---
# Distributions for counts

The chance of having the outcome across more than one trial (e.g., the probability of heads across 5 tosses) follows the binomial distribution. Notice that we now have two datapoints: the trial outcome (heads or tails), and how many trials occurred (5). 


--
One way of thinking of this difference is it shifts the focus from the outcome of a trial (whether it was heads) to counting how many trials resulted in the outcome (how often it was heads).


--
When might this difference apply to the research setting? Perhaps we're not interested in the relationship between an independent variable and *having* the outcome, but instead its relationship with **how many times** the outcome occurs in a certain population, or over a certain timeframe.


---
# Distributions for counts

In research where the outcome is how many or how often an outcome occurs, the research question is often focused on an outcome that is relatively rare or infrequent. In other words, the research question is not usually about something that happens (nearly) all of the time or to (almost) everyone. Some examples:


--
- Number of absences in a term (most students have few or zero absences)


--
- Number of hospitalization in a year (most people will not have been hospitalized)


--
- Number of days per month a participant reported having little interest in usual activities (most participants report few or no days with little interest)


--
The resulting distribution of counts is skewed toward 0, and one probability distribution we can use in this situation is the Poisson. 


---
# Distributions for counts
The Poisson distribution is a special case of the binomial distribution, where we have a large number of trials but the outcome of interest occurs infrequently. Another option is the negative binomial distribution. What's the difference? 


--
- Poisson assumes the average number of counts is equal to how much variability there is in the counts. In practice, count data are often overdispersed, meaning there is a greater amount of variability than the mean. This can bias standard errors, and therefore p-values and confidence intervals.


--
- Negative binomial does not make this assumption. Instead, it aims to model and account for dispersion, potentially making it more versatile. 


---
# Assessing variability

Let's compare the mean and variance of the `DaysMHBad_count` variable we looked at earlier. This was its distribution: 

&lt;img src="EDUC645_poisson_regression_Sp23_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;" /&gt;

---
# Assessing variability

We could see it's very skewed, but is it overdispersed too?


--

```r
NHANES_data1112 %&gt;% 
  summarize(mean = mean(DaysMHBad_count),
            variance = var(DaysMHBad_count))
```

<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-4">
<col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">mean</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">variance</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.91</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">59.9</td></tr>
</table>



--
The variance of the counts far exceeds the mean, which means we very likely have overdispersion.

---
# Fitting a model

Now that we know the data are likely overdispersed, we should proceed with a negative binomial model. We use the `glm.nb` function from the MASS package (built into R). 


--

```r
library(MASS)
mod_1 &lt;- glm.nb(DaysMHBad_count ~ PhysActive, data = NHANES_data1112)
```


--
We already know the data likely violate the Poisson assumption of mean = variance, but let's compare this model to a Poisson model to illustrate the impact on fit: 


--
**Deviance:**


```r
mod_1b &lt;- glm(DaysMHBad_count ~ PhysActive, family = "poisson",
              data = NHANES_data1112)

mod_1b$null.deviance
```

```
#&gt; [1] 35005.86
```

```r
mod_1$null.deviance
```

```
#&gt; [1] 2677.782
```

---
# Fitting a model

**AIC:**


```r
mod_1b$aic
```

```
#&gt; [1] 39421.75
```

```r
mod_1$aic
```

```
#&gt; [1] 13292.91
```


--
And most critically, we can see that the Poisson gave us much smaller standard errors, which would produce artificially narrow confidence intervals. 


```r
summary(mod_1b)$coefficients[2, "Std. Error"]
```

```
#&gt; [1] 0.01762778
```

```r
summary(mod_1)$coefficients[2, "Std. Error"]
```

```
#&gt; [1] 0.08484463
```


---
# Fitting a model

We can also look at whether the negative binomial model better accounts for overdispersion. We'll use the DHARMa package again. 


```r
mod_1_residuals &lt;- simulateResiduals(mod_1)
testDispersion(mod_1_residuals, alternative = "greater", plot = F)
```

```
#&gt; 
#&gt; 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
#&gt; 	simulated
#&gt; 
#&gt; data:  simulationOutput
#&gt; dispersion = 0.63292, p-value = 1
#&gt; alternative hypothesis: greater
```


--
Compared with the Poisson:




```r
mod_1b_residuals_p$p.value
```

```
#&gt; [1] 0
```

---
# Basic interpretaton 

Like logistic regression, we have to exponentiate the model coefficients to interpret the results.


--

```r
mod_1 %&gt;% 
  broom::tidy(exponentiate = TRUE, conf.int = TRUE)
```

<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-12">
<col><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">conf.low</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">conf.high</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.19</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0575</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">20.2&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">8.63e-91</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.86</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.58</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">PhysActiveInactive</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.49</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0848</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.71</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.48e-06</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.26</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.76</td></tr>
</table>



--
With counts, the exponentiated coefficient is a **rate ratio**. 


--
- Here, it tells us that compared with active participants, inactive participants experienced 1.5 times as many days per month with poor mental health. 

- Inactive participants experienced 50% more poor mental health days per month than active participants.

---
# To Dos

### Assignments
- Quiz 2 due May 5 (available tomorrow morning)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
